Конспект по теме «Создаем первого Telegram-бота»
Интернет

Интернет - сеть компьютеров, соединенных между собой.
Компьютеры могут обмениваться информацией: отправлять запросы и получать ответы.

Что происходит, когда вы набираете в браузере yandex.ru и нажимаете Enter?

Браузер некоторым образом узнает адрес компьютера, который может ответить на запрос “открой yandex.ru” (как это происходит, выходит за рамки нашего курса).
Браузер формирует запрос по специальным правилам и отправляет его по сети этому компьютеру.
На компьютере установлена специальная программа, которая умеет обрабатывать такие запросы. Она называется сервер (и сам компьютер тоже иногда называют сервер).
Программа (сервер) формирует ответ и отправляет его обратно на компьютер, отправивший его (мы его назовем клиент).
Браузер на компьютере-клиенте отображает пришедший ему ответ в соответствии с его типом и правилами.
Хорошая статья про модель “Клиент-сервер” - https://habr.com/ru/post/495698/

Telegram

По похожему принципу работает и Telegram (и мессенджеры в принципе).

Получение сообщений

Клиент (в данном случае приложение на телефоне или компьютере) постоянно отправляет на сервер Telegram запросы о наличии новых сообщений.
Если сообщения есть - сервер отправляет их клиенту.
Клиент отображает их в интерфейсе.
Отправка сообщений

Клиент отправляет сообщение на сервер Telegram.
Сервер сохраняет сообщения для клиента, которому оно отправлено (см. Получение сообщений).
Telegram-боты

Это специальные программы (клиенты), которые постоянно обращаются к серверу Telegram, получают отправленные им сообщения и отправляют обратно ответы на них.

Как создать бота?

Создание бота

Находим в Telegram контакт @BotFather.
Отправляем ему /newbot.
Выбираем имя бота.
Выбираем никнейм бота (должен заканчиваться на Bot).
Копируем токен.
Написание программы, которая будет отвечать на сообщения

Для создания ботов для Telegram используются различные библиотеки, которые берут на себя взаимодействие с серверами Telegram и прочую служебную функциональность, оставляя пользователю написание логики ответа на сообщения.

Таких библиотек для Python множество, мы будем использовать telebot https://github.com/eternnoir/pyTelegramBotAPI

Построчное объяснение кода
#1 Импортируем библиотеку.
#3 Помещаем токен, который получили ранее, в переменную.
#5 Создаем переменную bot. Она будет ключевой во всей программе. Это объект. Внутри него уже есть функции, которые мы будем вызывать.
#7 Специальный синтаксис, который указывает, какие именно сообщения будет обрабатывать определяемая дальше функция.
#8 Определение функции echo, принимающей один параметр - сообщение (на которое мы и будем отвечать).
#9 Тело функции. Отправляем сообщение в тот же чат, откуда получили (message.chat.id) с тем же текстом (message.text).

Как запустить бота?

Можно сделать это и на своем компьютере, но лучше сделать это на специальном облачном сервере. В курсе мы используем сайт pythonanywhere.com.

Обзор Pythonanywhere

Создаем новый файл.

Устанавливаем библиотеку.
В открывшемся окне внизу жмем кнопку “Run bash console”
В открывшейся внизу ( !!! ) консоли пишем команду pip3 install --user pytelegrambotapi
Жмем Enter

Пишем и запускаем код.

import telebot

token = ''

bot = telebot.TeleBot(token)


@bot.message_handler(content_types=["text"])
def echo(message):
    bot.send_message(message.chat.id, message.text)


bot.polling(none_stop=True)

Модификация кода
import telebot # импорт библиотеки
import random

token = "8352397295:AAGxtkKuT5AFABL5J2AOE5I3-w64259Nshs" # строковая переменная

bot = telebot.TeleBot(token) # создание переменной

RANDOM_TASKS = ['Написать письмо', 'Выучить Python',
                'Посмотреть 4 сезон Рик и Морти']

name = "Таня"

HELP = '''
Список доступных команд:
/print  - список доступных команд
/add - добавить задачу
/show - все задачи
/random - добавить на сегодня случайную задачу
/help - Напечатать help
'''

tasks = {}
def add_todo(date, task):
    if date in tasks:
        tasks[date].append(task)
    else:
        tasks[date] = []
        tasks[date].append(task)

@bot.message_handler(commands=["help"]) # декоратор. регистрация сообщений с типом: текст

def help(message):
    bot.send_message(message.chat.id, HELP)

@bot.message_handler(commands=["add"])

def add(message):
    command = message.text.split(maxsplit=2)
    date = command[1].lower()
    task = command[2]
    add_todo(date, task)
    text = "Задача " + task + " добавлена на дату " + date
    bot.send_message(message.chat.id, text)

@bot.message_handler(commands=["random_add"])

def random_add(message):
    date = "сегодня"
    task = random.choice(RANDOM_TASKS)
    add_todo(date, task)
    text = "Задача" + " добавлена на дату " + date
    bot.send_message(message.chat.id, text)

@bot.message_handler(commands=["show", "print"])

def show(message):
    command = message.text.split(maxsplit=1)
    date = command[1].lower()
    text = ""
    if date in tasks:
        text = date.upper() + "\n"
        for task in tasks[date]:
            text = text + "[] " + task + "\n"
    else:
        text = "Задач на эту дату нет"
    bot.send_message(message.chat.id, text)


def echo(message): # функция обработчика, принимает 1 сообщение
    if name in message.text:
        bot.send_message(message.chat.id, "Ба! Знакомые все лица")
    else:
        bot.send_message(message.chat.id, message.text) # ответ на сообщение

bot.polling(none_stop=True) # постоянно обращается к серверам телеграм
